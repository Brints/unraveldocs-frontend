<div class="google-signup-container" [attr.data-theme]="config().theme">

  <!-- Google One-Tap (if enabled) -->
  @if (showOneTap()) {
    <div id="g_id_onload" class="one-tap-container"></div>
  }

  <!-- Main Google Signup Button -->
  <div class="google-button-container">
    <button
      type="button"
      class="google-signup-btn"
      [class.full-width]="fullWidth"
      [class.loading]="isLoading()"
      [disabled]="!isReady() || isLoading()"
      (click)="handleGoogleSignup()">

      <!-- Loading Spinner -->
      @if (isLoading()) {
        <svg class="btn-spinner" width="20" height="20" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="3" opacity="0.25" fill="none"/>
          <path fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"/>
        </svg>
      } @else {
        <!-- Official Google Icon -->
        <svg class="google-icon" width="18" height="18" viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">
          <g fill="none" fill-rule="evenodd">
            <path d="M17.64 9.205c0-.639-.057-1.252-.164-1.841H9v3.481h4.844a4.14 4.14 0 0 1-1.796 2.716v2.259h2.908c1.702-1.567 2.684-3.875 2.684-6.615z" fill="#4285F4"/>
            <path d="M9 18c2.43 0 4.467-.806 5.956-2.18l-2.908-2.259c-.806.54-1.837.86-3.048.86-2.344 0-4.328-1.584-5.036-3.711H.957v2.332A8.997 8.997 0 0 0 9 18z" fill="#34A853"/>
            <path d="M3.964 10.71A5.41 5.41 0 0 1 3.682 9c0-.593.102-1.17.282-1.71V4.958H.957A8.996 8.996 0 0 0 0 9c0 1.452.348 2.827.957 4.042l3.007-2.332z" fill="#FBBC05"/>
            <path d="M9 3.58c1.321 0 2.508.454 3.44 1.345l2.582-2.58C13.463.891 11.426 0 9 0A8.997 8.997 0 0 0 .957 4.958L3.964 7.29C4.672 5.163 6.656 3.58 9 3.58z" fill="#EA4335"/>
          </g>
        </svg>
      }

      <span class="btn-text">{{ getButtonText() }}</span>
    </button>
  </div>

  <!-- Error Display -->
  @if (authError()) {
    <div class="error-message" role="alert">
      <svg class="error-icon" width="16" height="16" viewBox="0 0 24 24">
        <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
      </svg>
      {{ getErrorMessage() }}
    </div>
  }

  <!-- Additional Options Form (shown after Google auth if needed) -->
  @if (showAdditionalOptions()) {
    <div class="additional-options">
      <h3>Complete Your Profile</h3>
      <form [formGroup]="additionalForm" (ngSubmit)="completeSignup()" class="additional-form">

        @if (config().showMarketingConsent) {
          <app-form-input
            label="Marketing Communications"
            type="checkbox"
            helpText="Receive product updates and special offers"
            [control]="marketingControl">
          </app-form-input>
        }

        @if (config().showReferralCode) {
          <app-form-input
            label="Referral Code (Optional)"
            type="text"
            placeholder="Enter referral code"
            [control]="referralCodeControl"
            helpText="Have a referral code? Enter it here for special benefits">
          </app-form-input>
        }

        <div class="form-actions">
          <app-button
            type="submit"
            variant="primary"
            [isLoading]="isCompletingSignup()"
            [disabled]="additionalForm.invalid || isCompletingSignup()">
            Complete Signup
          </app-button>

          <app-button
            type="button"
            variant="ghost"
            (clicked)="skipAdditionalOptions()"
            [disabled]="isCompletingSignup()">
            Skip for now
          </app-button>
        </div>
      </form>
    </div>
  }

  <!-- Privacy Notice -->
  @if (showPrivacyNotice) {
    <div class="privacy-notice">
      <p class="privacy-text">
        By continuing with Google, you agree to our
        <a href="/terms" target="_blank" rel="noopener noreferrer" class="privacy-link">Terms of Service</a>
        and
        <a href="/privacy-policy" target="_blank" rel="noopener noreferrer" class="privacy-link">Privacy Policy</a>.
      </p>
    </div>
  }

  <!-- Loading Overlay -->
  @if (isLoading()) {
    <div class="loading-overlay">
      <div class="loading-spinner">
        <svg class="animate-spin" width="24" height="24" viewBox="0 0 24 24">
          <circle cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4" opacity="0.25" fill="none"/>
          <path fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"/>
        </svg>
      </div>
    </div>
  }
</div>
