<!-- Storage & Usage Page -->
<div class="storage-page">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <h1 class="page-title">Storage & Usage</h1>
      <p class="page-subtitle">Monitor your storage, document uploads, and OCR usage</p>
    </div>
    <button
      type="button"
      class="refresh-btn"
      (click)="refreshData()"
      [disabled]="isLoading()">
      <svg class="w-5 h-5" [class.animate-spin]="isLoading()" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
      </svg>
      <span>Refresh</span>
    </button>
  </div>

  <!-- Loading State -->
  @if (isLoading() && !storageInfo()) {
    <div class="loading-container">
      <div class="loading-spinner"></div>
      <p class="loading-text">Loading storage information...</p>
    </div>
  }

  <!-- Error State -->
  @if (error()) {
    <div class="error-alert">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
      </svg>
      <span>{{ error() }}</span>
    </div>
  }

  @if (storageInfo(); as info) {
    <!-- Subscription Overview Card -->
    <div class="overview-card">
      <div class="overview-header">
        <div class="plan-info">
          <div class="plan-badge" [class.premium]="info.subscriptionPlan !== 'Free'">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              @if (info.subscriptionPlan === 'Free') {
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
              } @else {
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
              }
            </svg>
            <span>{{ info.subscriptionPlan }} Plan</span>
          </div>
          <span class="billing-interval">{{ info.billingInterval }}</span>
        </div>
        @if (!info.unlimited) {
          <div class="reset-info">
            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <span class="reset-text">
              @if (daysUntilReset() !== null) {
                Quota resets in <strong>{{ daysUntilReset() }} days</strong>
                <span class="reset-date">({{ quotaResetFormatted() }})</span>
              }
            </span>
          </div>
        }
      </div>

      <!-- Quick Status Badges -->
      <div class="status-badges">
        <div class="status-badge" [class]="getStatusBadgeClass(info.documentQuotaExceeded)">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            @if (info.documentQuotaExceeded) {
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
            } @else {
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
            }
          </svg>
          <span>Documents: {{ info.documentQuotaExceeded ? 'Quota Exceeded' : 'Within Limit' }}</span>
        </div>
        <div class="status-badge" [class]="getStatusBadgeClass(info.ocrQuotaExceeded)">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            @if (info.ocrQuotaExceeded) {
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
            } @else {
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
            }
          </svg>
          <span>OCR Pages: {{ info.ocrQuotaExceeded ? 'Quota Exceeded' : 'Within Limit' }}</span>
        </div>
        <div class="status-badge" [class]="getStatusBadgeClass(info.quotaExceeded)">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            @if (info.quotaExceeded) {
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
            } @else {
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
            }
          </svg>
          <span>Storage: {{ info.quotaExceeded ? 'Quota Exceeded' : 'Within Limit' }}</span>
        </div>
      </div>
    </div>

    <!-- Usage Cards Grid -->
    <div class="usage-grid">
      <!-- Storage Usage Card -->
      <div class="usage-card">
        <div class="card-header">
          <div class="card-icon storage">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"/>
            </svg>
          </div>
          <div class="card-title-group">
            <h3 class="card-title">Storage</h3>
            <span class="card-subtitle">File storage usage</span>
          </div>
        </div>

        <div class="usage-stats">
          <div class="usage-main">
            @if (info.unlimited) {
              <span class="usage-value">{{ info.storageUsedFormatted }}</span>
              <span class="usage-unlimited">Unlimited</span>
            } @else {
              <span class="usage-value">{{ info.storageUsedFormatted }}</span>
              <span class="usage-separator">/</span>
              <span class="usage-limit">{{ info.storageLimitFormatted }}</span>
            }
          </div>
          <div class="usage-percentage" [class.exceeded]="info.quotaExceeded">
            {{ info.percentageUsed | number:'1.1-1' }}%
          </div>
        </div>

        @if (!info.unlimited) {
          <div class="progress-container">
            <div class="progress-bar">
              <div
                class="progress-fill"
                [class]="getProgressBarClass(storagePercentage(), info.quotaExceeded)"
                [style.width.%]="storagePercentage()">
              </div>
            </div>
          </div>
          <div class="usage-details">
            <span class="detail-item">
              <span class="detail-label">Remaining:</span>
              <span class="detail-value">{{ formatBytes(info.remainingStorage) }}</span>
            </span>
          </div>
        } @else {
          <div class="unlimited-badge">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
            </svg>
            <span>Unlimited Storage</span>
          </div>
        }
      </div>

      <!-- Document Uploads Card -->
      <div class="usage-card">
        <div class="card-header">
          <div class="card-icon documents">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
            </svg>
          </div>
          <div class="card-title-group">
            <h3 class="card-title">Document Uploads</h3>
            <span class="card-subtitle">Monthly upload quota</span>
          </div>
        </div>

        <div class="usage-stats">
          <div class="usage-main">
            @if (info.documentsUnlimited) {
              <span class="usage-value">{{ info.documentsUploaded }}</span>
              <span class="usage-unlimited">Unlimited</span>
            } @else {
              <span class="usage-value">{{ info.documentsUploaded }}</span>
              <span class="usage-separator">/</span>
              <span class="usage-limit">{{ info.documentUploadLimit }}</span>
            }
          </div>
          @if (!info.documentsUnlimited) {
            <div class="usage-percentage" [class.exceeded]="info.documentQuotaExceeded">
              {{ documentsPercentage() }}%
            </div>
          }
        </div>

        @if (!info.documentsUnlimited) {
          <div class="progress-container">
            <div class="progress-bar">
              <div
                class="progress-fill"
                [class]="getProgressBarClass(documentsPercentage(), info.documentQuotaExceeded)"
                [style.width.%]="documentsPercentage()">
              </div>
            </div>
          </div>
          <div class="usage-details">
            <span class="detail-item">
              <span class="detail-label">Remaining:</span>
              <span class="detail-value">{{ info.documentsRemaining }} documents</span>
            </span>
          </div>
          @if (info.documentQuotaExceeded) {
            <div class="quota-warning">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
              </svg>
              <span>You've exceeded your monthly document upload limit</span>
            </div>
          }
        } @else {
          <div class="unlimited-badge">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
            </svg>
            <span>Unlimited Uploads</span>
          </div>
        }
      </div>

      <!-- OCR Pages Card -->
      <div class="usage-card">
        <div class="card-header">
          <div class="card-icon ocr">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
            </svg>
          </div>
          <div class="card-title-group">
            <h3 class="card-title">OCR Pages</h3>
            <span class="card-subtitle">Monthly OCR processing quota</span>
          </div>
        </div>

        <div class="usage-stats">
          <div class="usage-main">
            @if (info.ocrUnlimited) {
              <span class="usage-value">{{ info.ocrPagesUsed }}</span>
              <span class="usage-unlimited">Unlimited</span>
            } @else {
              <span class="usage-value">{{ info.ocrPagesUsed }}</span>
              <span class="usage-separator">/</span>
              <span class="usage-limit">{{ info.ocrPageLimit }}</span>
            }
          </div>
          @if (!info.ocrUnlimited) {
            <div class="usage-percentage" [class.exceeded]="info.ocrQuotaExceeded">
              {{ ocrPercentage() }}%
            </div>
          }
        </div>

        @if (!info.ocrUnlimited) {
          <div class="progress-container">
            <div class="progress-bar">
              <div
                class="progress-fill"
                [class]="getProgressBarClass(ocrPercentage(), info.ocrQuotaExceeded)"
                [style.width.%]="ocrPercentage()">
              </div>
            </div>
          </div>
          <div class="usage-details">
            <span class="detail-item">
              <span class="detail-label">Remaining:</span>
              <span class="detail-value">{{ info.ocrPagesRemaining }} pages</span>
            </span>
          </div>
          @if (info.ocrQuotaExceeded) {
            <div class="quota-warning">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
              </svg>
              <span>You've exceeded your monthly OCR page limit</span>
            </div>
          }
        } @else {
          <div class="unlimited-badge">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
            </svg>
            <span>Unlimited OCR Pages</span>
          </div>
        }
      </div>
    </div>

    <!-- Upgrade CTA (for Free plan) -->
    @if (info.subscriptionPlan === 'Free') {
      <div class="upgrade-cta">
        <div class="cta-content">
          <div class="cta-icon">
            <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
            </svg>
          </div>
          <div class="cta-text">
            <h3>Need more storage or processing power?</h3>
            <p>Upgrade to a premium plan for higher limits and additional features.</p>
          </div>
        </div>
        <a routerLink="/subscription/plans" class="cta-button">
          <span>View Plans</span>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
          </svg>
        </a>
      </div>
    }

    <!-- Usage Tips -->
    <div class="tips-section">
      <h3 class="tips-title">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
        </svg>
        <span>Usage Tips</span>
      </h3>
      <div class="tips-grid">
        <div class="tip-card">
          <div class="tip-icon">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
            </svg>
          </div>
          <div class="tip-content">
            <h4>Delete Unused Documents</h4>
            <p>Remove old or unnecessary documents to free up storage space and document quota.</p>
          </div>
        </div>
        <div class="tip-card">
          <div class="tip-icon">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
            </svg>
          </div>
          <div class="tip-content">
            <h4>Optimize Images</h4>
            <p>Compress images before uploading to reduce storage usage without losing quality.</p>
          </div>
        </div>
        <div class="tip-card">
          <div class="tip-icon">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
            </svg>
          </div>
          <div class="tip-content">
            <h4>Plan Your Uploads</h4>
            <p>Your quota resets monthly. Plan your uploads to maximize usage within each billing cycle.</p>
          </div>
        </div>
      </div>
    </div>
  }
</div>
