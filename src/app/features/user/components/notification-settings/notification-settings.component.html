<!-- Notification Settings Page -->
<div class="settings-page">
  <!-- Page Header -->
  <div class="page-header">
    <div class="header-content">
      <div>
        <h1 class="page-title">Notification Preferences</h1>
        <p class="page-subtitle">Manage how you receive notifications</p>
      </div>
      @if (saveSuccess()) {
        <span class="save-indicator success">
          <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
          </svg>
          Saved
        </span>
      }
      @if (isSaving()) {
        <span class="save-indicator saving">
          <span class="spinner"></span>
          Saving...
        </span>
      }
    </div>
  </div>

  @if (isLoading()) {
    <!-- Loading State -->
    <div class="loading-state">
      @for (i of [1,2,3]; track i) {
        <div class="settings-card skeleton-card">
          <div class="skeleton-header">
            <div class="skeleton-line w-32 h-6"></div>
            <div class="skeleton-line w-48 h-4"></div>
          </div>
          <div class="skeleton-content">
            @for (j of [1,2,3,4]; track j) {
              <div class="skeleton-row">
                <div class="skeleton-line w-64 h-5"></div>
                <div class="skeleton-toggle"></div>
              </div>
            }
          </div>
        </div>
      }
    </div>
  } @else {
    <!-- Email Notifications -->
    <div class="settings-card">
      <div class="card-header">
        <div class="header-icon email">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
          </svg>
        </div>
        <div class="header-content">
          <h2 class="card-title">Email Notifications</h2>
          <p class="card-description">Receive notifications via email</p>
        </div>
        <div class="header-actions">
          <button type="button" class="text-btn" (click)="enableAllEmail()">Enable all</button>
          <span class="action-divider">|</span>
          <button type="button" class="text-btn" (click)="disableAllEmail()">Disable all</button>
        </div>
      </div>
      <div class="card-content">
        <div class="notification-list">
          @for (notification of emailNotifications; track notification.key) {
            <div class="notification-item">
              <div class="notification-info">
                <h3 class="notification-label">{{ notification.label }}</h3>
                <p class="notification-description">{{ notification.description }}</p>
              </div>
              <label class="toggle-switch">
                <input
                  type="checkbox"
                  [checked]="getEmailValue(notification.key)"
                  (change)="toggleEmailNotification(notification.key)"/>
                <span class="toggle-slider"></span>
              </label>
            </div>
          }
        </div>
      </div>
    </div>

    <!-- Push Notifications -->
    <div class="settings-card">
      <div class="card-header">
        <div class="header-icon push">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
          </svg>
        </div>
        <div class="header-content">
          <h2 class="card-title">Push Notifications</h2>
          <p class="card-description">Receive real-time push notifications</p>
        </div>
        <div class="header-actions">
          <button type="button" class="text-btn" (click)="enableAllPush()">Enable all</button>
          <span class="action-divider">|</span>
          <button type="button" class="text-btn" (click)="disableAllPush()">Disable all</button>
        </div>
      </div>
      <div class="card-content">
        <div class="notification-list">
          @for (notification of pushNotifications; track notification.key) {
            <div class="notification-item">
              <div class="notification-info">
                <h3 class="notification-label">{{ notification.label }}</h3>
                <p class="notification-description">{{ notification.description }}</p>
              </div>
              <label class="toggle-switch">
                <input
                  type="checkbox"
                  [checked]="getPushValue(notification.key)"
                  (change)="togglePushNotification(notification.key)"/>
                <span class="toggle-slider"></span>
              </label>
            </div>
          }
        </div>
      </div>
      <div class="card-footer">
        @if (!pushService.isSupported()) {
          <div class="info-banner warning">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
            </svg>
            <p>Push notifications are not supported in this browser.</p>
          </div>
        } @else if (pushService.permissionState() === 'denied') {
          <div class="info-banner warning">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
            </svg>
            <p>Push notifications are blocked. Please enable them in your browser settings.</p>
          </div>
        } @else if (pushService.isSubscribed()) {
          <div class="info-banner success">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
            </svg>
            <p>Push notifications are enabled.
              <a routerLink="/notifications" class="link-btn">View Notifications</a>
              <span class="link-separator">|</span>
              <button type="button" class="link-btn" (click)="disableBrowserPush()" [disabled]="pushService.isLoading()">
                @if (pushService.isLoading()) {
                  Disabling...
                } @else {
                  Disable Push
                }
              </button>
            </p>
          </div>
        } @else {
          <div class="info-banner">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <p>Push notifications require browser permission.
              <button type="button" class="link-btn" (click)="enableBrowserPush()" [disabled]="pushService.isLoading()">
                @if (pushService.isLoading()) {
                  Enabling...
                } @else {
                  Enable in browser
                }
              </button>
            </p>
          </div>
        }
        @if (pushService.error()) {
          <div class="info-banner error">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <p>{{ pushService.error() }}</p>
          </div>
        }
      </div>
    </div>

    <!-- SMS Notifications -->
    <div class="settings-card">
      <div class="card-header">
        <div class="header-icon sms">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"/>
          </svg>
        </div>
        <div class="header-content">
          <h2 class="card-title">SMS Notifications</h2>
          <p class="card-description">Receive critical alerts via SMS</p>
        </div>
      </div>
      <div class="card-content">
        <div class="notification-list">
          @for (notification of smsNotifications; track notification.key) {
            <div class="notification-item">
              <div class="notification-info">
                <h3 class="notification-label">{{ notification.label }}</h3>
                <p class="notification-description">{{ notification.description }}</p>
              </div>
              <label class="toggle-switch">
                <input
                  type="checkbox"
                  [checked]="getSmsValue(notification.key)"
                  (change)="toggleSmsNotification(notification.key)"/>
                <span class="toggle-slider"></span>
              </label>
            </div>
          }
        </div>
      </div>
      <div class="card-footer">
        <div class="info-banner warning">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
          </svg>
          <p>SMS notifications require a verified phone number. <a href="/settings/profile" class="link-btn">Add phone number</a></p>
        </div>
      </div>
    </div>

    <!-- Notification Schedule -->
    <div class="settings-card">
      <div class="card-header">
        <div class="header-icon schedule">
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
          </svg>
        </div>
        <div class="header-content">
          <h2 class="card-title">Quiet Hours</h2>
          <p class="card-description">Pause non-critical notifications during specific hours</p>
        </div>
      </div>
      <div class="card-content">
        <div class="quiet-hours-setting">
          <div class="setting-row">
            <div class="setting-info">
              <h3 class="notification-label">Enable Quiet Hours</h3>
              <p class="notification-description">Pause notifications during set hours (security alerts will still come through)</p>
            </div>
            <label class="toggle-switch">
              <input type="checkbox"/>
              <span class="toggle-slider"></span>
            </label>
          </div>
          <div class="time-range-selector">
            <div class="time-input">
              <label>From</label>
              <input type="time" value="22:00" class="form-input"/>
            </div>
            <span class="time-separator">to</span>
            <div class="time-input">
              <label>To</label>
              <input type="time" value="07:00" class="form-input"/>
            </div>
          </div>
        </div>
      </div>
    </div>
  }
</div>

