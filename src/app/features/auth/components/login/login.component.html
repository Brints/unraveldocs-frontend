<app-header></app-header>

<main class="pt-20">
  <!-- Login Form Container -->
  <div class="login-container">
    <div class="login-card">
      <!-- Header -->
      <div class="login-header">
        <h1 class="login-title">Welcome back</h1>
        <p class="login-subtitle">
          Don't have an account?
          <a routerLink="/auth/signup" class="signup-link">Create account</a>
        </p>
      </div>

      <!-- Google Login Component -->
      <div class="google-auth-section">
        <app-google-signup
          [clientId]="environment.google.clientId"
          [fullWidth]="true"
          [usePopup]="environment.features.googlePopupAuth"
          [signupConfig]="googleConfig"
          [additionalScopes]="[]"
          (signupStarted)="onGoogleLoginStarted()"
          (signupSuccess)="onGoogleLoginSuccess($event)"
          (signupError)="onGoogleLoginError($event)"
          (signupCancelled)="onGoogleLoginCancelled()">
        </app-google-signup>

        <!-- Google Error Display -->
        @if (googleError()) {
          <div class="google-error-message" role="alert">
            <svg class="error-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
            </svg>
            {{ googleError()?.message }}
          </div>
        }
      </div>

      <!-- Divider -->
      <div class="divider">
        <span class="divider-text">or sign in with email</span>
      </div>

      <!-- Rate Limiting Warning -->
      @if (isRateLimited()) {
        <div class="rate-limit-warning" role="alert">
          <svg class="warning-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
          </svg>
          <div class="rate-limit-content">
            <p class="rate-limit-message">Too many failed attempts. Please wait before trying again.</p>
            @if (retryAfter() > 0) {
              <p class="rate-limit-timer">
                Try again in {{ formatRetryTime() }}
              </p>
            }
          </div>
        </div>
      }

      <!-- Login Attempts Warning -->
      @if (loginAttempts() > 2 && !isRateLimited()) {
        <div class="attempts-warning">
          <svg class="warning-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
          </svg>
          {{ attemptsRemaining() }} attempts remaining before account is temporarily locked
        </div>
      }

      <!-- Global Error Message -->
      @if (error()) {
        <div class="error-alert" role="alert">
          <svg class="error-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
          </svg>
          {{ getErrorMessage() }}
        </div>
      }

      <!-- Login Form -->
      <form [formGroup]="loginForm" (ngSubmit)="onSubmit()" class="login-form" novalidate>

        <!-- Email Input -->
        <app-form-input
          label="Email Address"
          type="email"
          placeholder="Enter your email address"
          [required]="true"
          [control]="emailControl"
          [disabled]="isAnyLoginInProgress() || isRateLimited()"
          helpText="The email address you used to create your account">
        </app-form-input>

        <!-- Password Input -->
        <app-form-input
          label="Password"
          type="password"
          placeholder="Enter your password"
          [required]="true"
          [control]="passwordControl"
          [disabled]="isAnyLoginInProgress() || isRateLimited()">
        </app-form-input>

        <!-- Remember Me and Forgot Password -->
        <div class="form-options">
          <label class="remember-me-label">
            <input
              type="checkbox"
              [checked]="rememberMeControl.value"
              (change)="toggleRememberMe()"
              [disabled]="isAnyLoginInProgress() || isRateLimited()"
              class="checkbox-input">
            <span class="checkbox-custom"></span>
            <span class="checkbox-text">Remember me</span>
          </label>

          <a
            routerLink="/auth/forgot-password"
            class="forgot-password-link"
            [class.disabled]="isAnyLoginInProgress()">
            Forgot password?
          </a>
        </div>

        <!-- Login Button -->
        <app-button
          type="submit"
          variant="primary"
          size="lg"
          [fullWidth]="true"
          [isLoading]="loading()"
          [disabled]="!canAttemptLogin()"
          loadingText="Signing in...">
          Sign In
        </app-button>

        <!-- Security Notice -->
        <div class="security-notice">
          <svg class="security-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
            <path d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M10,17L6,13L7.41,11.59L10,14.17L16.59,7.58L18,9L10,17Z"/>
          </svg>
          Your login is secured with industry-standard encryption
        </div>
      </form>
    </div>
  </div>
</main>

<app-footer></app-footer>
