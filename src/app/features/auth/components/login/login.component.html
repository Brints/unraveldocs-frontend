<!-- Login Form Container -->
<div class="login-container">
  <div class="login-card">
    <!-- Header -->
    <div class="login-header">
      <h1 class="login-title">Welcome back</h1>
      <p class="login-subtitle">
        Don't have an account?
        <a routerLink="/auth/signup" class="signup-link">Create account</a>
      </p>
    </div>

    <!-- Google Login Component -->
    <div class="google-auth-section">
      <app-google-signup
        [clientId]="environment.google.clientId"
        [fullWidth]="true"
        [usePopup]="environment.features.googlePopupAuth"
        [signupConfig]="googleConfig"
        [additionalScopes]="[]"
        (signupStarted)="onGoogleLoginStarted()"
        (signupSuccess)="onGoogleLoginSuccess($event)"
        (signupError)="onGoogleLoginError($event)"
        (signupCancelled)="onGoogleLoginCancelled()">
      </app-google-signup>

      <!-- Google Error Display -->
      <div *ngIf="googleError()" class="google-error-message" role="alert">
        <svg class="error-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
        </svg>
        {{ getGoogleErrorMessage() }}
      </div>
    </div>

    <!-- Divider -->
    <div class="divider">
      <span class="divider-text">or sign in with email</span>
    </div>

    <!-- Rate Limiting Warning -->
    <div *ngIf="isRateLimited()" class="rate-limit-warning" role="alert">
      <svg class="warning-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
        <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
      </svg>
      <div class="rate-limit-content">
        <p class="rate-limit-message">Too many failed login attempts</p>
        <p class="rate-limit-timer" *ngIf="retryAfter() > 0">
          Please wait {{ formatRetryTime() }} before trying again
        </p>
      </div>
    </div>

    <!-- Login Attempts Warning -->
    <div *ngIf="loginAttempts() > 2 && !isRateLimited()" class="attempts-warning">
      <svg class="warning-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
        <path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/>
      </svg>
      {{ attemptsRemaining() }} attempts remaining before account is temporarily locked
    </div>

    <!-- Global Error Message -->
    <div *ngIf="error()" class="error-alert" role="alert">
      <svg class="error-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
      </svg>
      {{ getErrorMessage() }}
    </div>

    <!-- Login Form -->
    <form [formGroup]="loginForm" (ngSubmit)="onSubmit()" class="login-form" novalidate>

      <!-- Email Input -->
      <app-form-input
        label="Email Address"
        type="email"
        placeholder="Enter your email address"
        [required]="true"
        [control]="emailControl"
        [disabled]="isAnyLoginInProgress() || isRateLimited()"
        helpText="The email address you used to create your account">
      </app-form-input>

      <!-- Password Input -->
      <app-form-input
        label="Password"
        type="password"
        placeholder="Enter your password"
        [required]="true"
        [control]="passwordControl"
        [disabled]="isAnyLoginInProgress() || isRateLimited()">
      </app-form-input>

      <!-- Remember Me and Forgot Password -->
      <div class="form-options">
        <label class="remember-me-label">
          <input
            type="checkbox"
            [checked]="rememberMeControl.value"
            (change)="toggleRememberMe()"
            [disabled]="isAnyLoginInProgress() || isRateLimited()"
            class="checkbox-input">
          <span class="checkbox-custom"></span>
          <span class="checkbox-text">Remember me</span>
        </label>

        <a
          routerLink="/auth/forgot-password"
          class="forgot-password-link"
          [class.disabled]="isAnyLoginInProgress()">
          Forgot password?
        </a>
      </div>

      <!-- Login Button -->
      <app-button
        type="submit"
        variant="primary"
        size="lg"
        fullWidth="true"
        [isLoading]="loading()"
        [disabled]="!canAttemptLogin()"
        loadingText="Signing in...">
        Sign In
      </app-button>

      <!-- Alternative Login Methods -->
      <div class="alternative-login" *ngIf="!isAnyLoginInProgress()">
        <p class="alternative-text">Or continue with</p>
        <div class="social-buttons">
          <app-button
            variant="outline"
            [isLoading]="isSocialLoading('github')"
            [disabled]="isAnyLoginInProgress() || isRateLimited()"
            (clicked)="loginWithGitHub()">
            <svg slot="icon-left" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
              <path d="M12 0C5.374 0 0 5.373 0 12 0 17.302 3.438 21.8 8.207 23.387c.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23A11.509 11.509 0 0112 5.803c1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576C20.566 21.797 24 17.3 24 12c0-6.627-5.373-12-12-12z"/>
            </svg>
            {{ getSocialButtonText('github') }}
          </app-button>
        </div>
      </div>

      <!-- Account Actions -->
      <div class="account-actions">
        <p class="account-help">
          Having trouble?
          <a href="/support" class="support-link">Contact support</a>
        </p>
      </div>
    </form>

    <!-- Security Notice -->
    <div class="security-notice">
      <svg class="security-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M10,17L6,13L7.41,11.59L10,14.17L16.59,7.58L18,9L10,17Z"/>
      </svg>
      Your login is secured with industry-standard encryption
    </div>
  </div>
</div>
