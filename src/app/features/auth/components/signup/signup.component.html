<!-- Signup Form Container -->
<div class="signup-container">
  <div class="signup-card">
    <!-- Header -->
    <div class="signup-header">
      <h1 class="signup-title">Create your account</h1>
      <p class="signup-subtitle">
        Already have an account?
        <a routerLink="/auth/login" class="login-link">Sign in</a>
      </p>
    </div>

    <!-- Google Signup Component -->
    <div class="google-auth-section">
      <app-google-signup
        [clientId]="environment.google.clientId"
        [fullWidth]="true"
        [usePopup]="environment.features.googlePopupAuth"
        [signupConfig]="googleConfig"
        [additionalScopes]="[]"
        (signupStarted)="onGoogleSignupStarted()"
        (signupSuccess)="onGoogleSignupSuccess($event)"
        (signupError)="onGoogleSignupError($event)"
        (signupCancelled)="onGoogleSignupCancelled()">
      </app-google-signup>

      <!-- Google Error Display -->
      <div *ngIf="googleError()" class="google-error-message" role="alert">
        <svg class="error-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
        </svg>
        {{ googleError()?.message }}
      </div>
    </div>

    <!-- Divider -->
    <div class="divider">
      <span class="divider-text">or continue with email</span>
    </div>

    <!-- Global Error Message (for email signup) -->
    <div *ngIf="authError()" class="error-alert" role="alert">
      <svg class="error-icon" width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
      </svg>
      {{ getErrorMessage() }}
    </div>

    <!-- Email Signup Form -->
    <form [formGroup]="signupForm" (ngSubmit)="onSubmit()" class="signup-form" novalidate>

      <!-- Full Name Input -->
      <app-form-input
        label="Full Name"
        type="text"
        placeholder="Enter your full name"
        [required]="true"
        [control]="fullNameControl"
        [disabled]="isAnySignupInProgress()"
        helpText="This will be displayed on your profile">
      </app-form-input>

      <!-- Email Input -->
      <app-form-input
        label="Email Address"
        type="email"
        placeholder="Enter your email address"
        [required]="true"
        [control]="emailControl"
        [disabled]="isAnySignupInProgress()"
        helpText="We'll use this to send you important updates">
      </app-form-input>

      <!-- Password Input -->
      <div class="password-field-group">
        <app-form-input
          label="Password"
          type="password"
          placeholder="Create a strong password"
          [required]="true"
          [control]="passwordControl"
          [disabled]="isAnySignupInProgress()">
        </app-form-input>

        <!-- Password Generator Toggle -->
        <button
          type="button"
          class="password-generator-toggle"
          (click)="showPasswordGenerator()"
          [disabled]="isAnySignupInProgress()">
          ðŸŽ² Generate secure password
        </button>

        <!-- Password Strength Indicator -->
        <app-password-strength
          [value]="passwordStrength()"
          [showFeedback]="false"
          [showRequirements]="passwordControl.dirty && passwordControl.value">
        </app-password-strength>
      </div>

      <!-- Confirm Password Input -->
      <app-form-input
        label="Confirm Password"
        type="password"
        placeholder="Confirm your password"
        [required]="true"
        [control]="confirmPasswordControl"
        [disabled]="isAnySignupInProgress()">
      </app-form-input>

      <!-- Terms and Marketing Checkboxes -->
      <div class="checkbox-group">
        <label class="checkbox-label" [class.error]="termsControl.invalid && termsControl.touched">
          <input
            type="checkbox"
            [checked]="termsControl.value"
            (change)="toggleTerms()"
            [disabled]="isAnySignupInProgress()"
            class="checkbox-input"
            required>
          <span class="checkbox-custom"></span>
          <span class="checkbox-text">
            I agree to the
            <a href="/terms" target="_blank" class="terms-link">Terms of Service</a>
            and
            <a href="/privacy" target="_blank" class="terms-link">Privacy Policy</a>
            <span class="required-indicator">*</span>
          </span>
        </label>

        <label class="checkbox-label">
          <input
            type="checkbox"
            [checked]="marketingControl.value"
            (change)="toggleMarketing()"
            [disabled]="isAnySignupInProgress()"
            class="checkbox-input">
          <span class="checkbox-custom"></span>
          <span class="checkbox-text">
            I'd like to receive product updates and marketing emails
          </span>
        </label>
      </div>

      <!-- Submit Button -->
      <app-button
        type="submit"
        variant="primary"
        size="lg"
        fullWidth="true"
        [isLoading]="isLoading()"
        [disabled]="!isFormValid() || isAnySignupInProgress()"
        loadingText="Creating account...">
        Create Account
      </app-button>

      <!-- Security Notice -->
      <div class="security-notice">
        <svg class="security-icon" width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
          <path d="M12,1L3,5V11C3,16.55 6.84,21.74 12,23C17.16,21.74 21,16.55 21,11V5L12,1M10,17L6,13L7.41,11.59L10,14.17L16.59,7.58L18,9L10,17Z"/>
        </svg>
        Your information is encrypted and secure
      </div>
    </form>
  </div>

  <!-- Password Generator Modal -->
  <div *ngIf="showPasswordGen()" class="modal-overlay" (click)="hidePasswordGenerator()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <app-password-generator
        (passwordGenerated)="onPasswordGenerated($event)"
        (closed)="hidePasswordGenerator()">
      </app-password-generator>
    </div>
  </div>
</div>
